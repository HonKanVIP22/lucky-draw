<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Lucky Draw Pro</title>
<style>
body{
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  font-family:'Segoe UI',Arial;
  color:#fff;
  text-align:center;
  margin:0;
}
.container{padding:40px}
.logo{height:80px;margin-bottom:10px}
h1{font-size:46px;margin:10px 0}
.card{
  background:#fff;color:#333;
  display:inline-block;
  padding:30px 50px;
  border-radius:18px;
  min-width:460px;
  box-shadow:0 25px 50px rgba(0,0,0,.35)
}
select,button,input{
  font-size:18px;
  padding:8px 14px;
  margin-top:10px
}
button{
  background:#e63946;
  color:#fff;
  border:none;
  border-radius:30px;
  padding:14px 40px;
  font-size:26px;
  cursor:pointer
}
button:hover{opacity:.9}
#result{
  font-size:44px;
  color:#e63946;
  margin-top:25px;
  min-height:60px
}
#log{
  margin-top:20px;
  text-align:left;
  max-height:220px;
  overflow:auto;
  font-size:15px
}
</style>
</head>
<body>

<div class="container">
  <img src="logo.png" class="logo">
  <h1>üéØ QUAY S·ªê MAY M·∫ÆN</h1>

  <div class="card">
    <div>
      <input type="file" id="fileInput" accept=".csv">
    </div>

    <div>
      <strong>üéÅ Ch·ªçn gi·∫£i:</strong><br>
      <select id="prize">
        <option>Gi·∫£i Nh·∫•t</option>
        <option>Gi·∫£i Nh√¨</option>
        <option>Gi·∫£i Ba</option>
        <option>Khuy·∫øn Kh√≠ch</option>
      </select>
    </div>

    <button onclick="draw()">QUAY</button>
    <div id="result">---</div>

    <button onclick="exportCSV()">üì• Xu·∫•t k·∫øt qu·∫£</button>

    <div id="log"></div>
  </div>
</div>

<script>
let items = [];
let results = [];

document.getElementById("fileInput").addEventListener("change", e=>{
  const reader = new FileReader();
  reader.onload = ()=>{
    const lines = reader.result.split("\n");
    items=[];
    for(let i=1;i<lines.length;i++){
      let [code,name]=lines[i].split(",");
      if(code && name){
        items.push({code:code.trim(),name:name.trim()});
      }
    }
    alert("ƒê√£ import "+items.length+" ng∆∞·ªùi");
  };
  reader.readAsText(e.target.files[0],"UTF-8");
});

function draw(){
  if(items.length===0){
    document.getElementById("result").innerText="H·∫æT DANH S√ÅCH";
    return;
  }
  let spin=25;
  let temp;
  let interval=setInterval(()=>{
    temp=items[Math.floor(Math.random()*items.length)];
    document.getElementById("result").innerText=temp.code+" - "+temp.name;
    spin--;
    if(spin<=0){
      clearInterval(interval);
      let index=items.indexOf(temp);
      items.splice(index,1);
      let prize=document.getElementById("prize").value;
      results.push({prize,...temp});
      log(prize,temp);
    }
  },80);
}

function log(prize,item){
  document.getElementById("log").innerHTML+=
    "üèÜ <b>"+prize+"</b>: "+item.code+" - "+item.name+"<br>";
}

function exportCSV(){
  let csv="Prize,Code,Name\n";
  results.forEach(r=>{
    csv+=`${r.prize},${r.code},${r.name}\n`;
  });
  let blob=new Blob([csv],{type:"text/csv"});
  let a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="ketqua_quayso.csv";
  a.click();
}
</script>

</body>
</html>
