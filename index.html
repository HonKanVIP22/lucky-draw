<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Lucky Draw Pro</title>

<style>
body{
  background:url("nen.jpg") center/cover no-repeat fixed;
  font-family:'Segoe UI',Arial;
  color:#fff;
  text-align:center;
  margin:0;
  min-height:100vh;
}
.overlay{
  background:rgba(0,0,0,0.35);
  min-height:100vh;
  padding-top:50px;
}
h1{
  font-size:64px;
  font-weight:900;
  letter-spacing:4px;
  margin-bottom:28px;
  background:linear-gradient(90deg,#fff176,#ffeb3b,#ffc107);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.title-icon{animation:rotateSlow 8s linear infinite;margin-right:14px}
.slot{display:flex;justify-content:center;gap:16px;margin:30px 0}
.digit{
  width:84px;height:118px;border-radius:16px;
  background:linear-gradient(180deg,#ffeb3b,#ffc107);
  color:#5d4037;font-size:66px;font-weight:900;
  display:flex;align-items:center;justify-content:center;
}
#spinBtn{
  width:190px;height:190px;border-radius:50%;
  background:radial-gradient(circle,#ffeb3b,#ffc107);
  color:#5d4037;font-size:34px;font-weight:900;border:none;cursor:pointer;
}
.right-panel{
  position:fixed;top:20px;right:20px;
  display:flex;flex-direction:column;gap:10px;
  background:rgba(0,0,0,.4);padding:12px;border-radius:16px;
}
.right-panel select,.right-panel input{
  width:150px;padding:8px;border-radius:12px;
  background:rgba(0,0,0,.5);color:#fff;border:none;text-align:center;
}
.export{background:#d50000;color:#fff;padding:8px;border-radius:20px;cursor:pointer}
.reset{background:#0d47a1;color:#fff;padding:8px;border-radius:20px;cursor:pointer}

#winnerBox{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.75);z-index:9999;
  align-items:center;justify-content:center;
}
#winnerContent{
  background:rgba(0,0,0,.85);padding:40px 60px;
  border-radius:30px;box-shadow:0 0 50px rgba(255,215,0,.9);
}
#winnerName{font-size:56px;font-weight:900}
#winnerCode{margin-top:12px;font-size:22px}

.result-box{
  margin:44px auto;width:88%;max-width:980px;
  background:rgba(0,0,0,0.5);border-radius:24px;padding:24px;
}
table{width:100%;border-collapse:collapse}
th,td{padding:14px}
.prize{color:#ffd54f;font-weight:800}
.code{font-family:monospace;font-size:20px}

@keyframes rotateSlow{from{transform:rotate(0)}to{transform:rotate(360deg)}}
</style>
</head>

<body>

<div class="right-panel">
  <select id="prize">
    <option>Gi·∫£i Nh·∫•t</option>
    <option>Gi·∫£i Nh√¨</option>
    <option>Gi·∫£i Ba</option>
    <option>Gi·∫£i Th∆∞·ªüng</option>
  </select>

  <input id="drawCount" type="number" value="1" min="1">

  <!-- IMPORT EXCEL -->
  <label class="export" style="text-align:center">
    ‚¨ÜÔ∏è Import Excel
    <input type="file" accept=".xlsx,.xls" onchange="importExcel(event)" hidden>
  </label>

  <button class="export" onclick="exportCSV()">üì• Xu·∫•t</button>
  <button class="reset" onclick="resetAll()">üîÑ Reset</button>
</div>

<div id="winnerBox">
  <div id="winnerContent">
    <h2>üéâ CH√öC M·ª™NG üéâ</h2>
    <div id="winnerName"></div>
    <div id="winnerCode"></div>
  </div>
</div>

<div class="overlay">
<h1><span class="title-icon">üéØ</span>QUAY S·ªê MAY M·∫ÆN</h1>

<div class="slot">
  <div class="digit">0</div><div class="digit">0</div>
  <div class="digit">0</div><div class="digit">0</div>
  <div class="digit">0</div>
</div>

<button id="spinBtn" onclick="draw()">QUAY</button>

<div class="result-box">
  <h2>üèÜ DANH S√ÅCH TR√öNG TH∆Ø·ªûNG</h2>
  <table>
    <thead><tr><th>Gi·∫£i</th><th>M√£ s·ªë</th><th>H·ªç t√™n</th></tr></thead>
    <tbody id="resultTable"></tbody>
  </table>
</div>
</div>

<!-- SheetJS -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<script>
const defaultItems=[
 {code:"00001",name:"Nguy·ªÖn VƒÉn Kan"},
 {code:"00002",name:"Tr·∫ßn Th·ªã Ng√¢n"}
];

let items=JSON.parse(localStorage.getItem("ITEMS"))||[...defaultItems];
let results=JSON.parse(localStorage.getItem("RESULTS"))||[];
window.onload=renderTable;

function spinDigits(t){
 let d=document.querySelectorAll(".digit"),i=0;
 let it=setInterval(()=>{
  d.forEach(x=>x.innerText=Math.floor(Math.random()*10));
  if(++i>40){clearInterval(it);t.code.split("").forEach((n,j)=>d[j].innerText=n);}
 },120);
}

function draw(){
 let c=parseInt(drawCount.value)||1;
 if(c>items.length)return alert("Kh√¥ng ƒë·ªß ng∆∞·ªùi");
 let p=prize.value;
 for(let k=0;k<c;k++){
  let i=Math.floor(Math.random()*items.length);
  let it=items.splice(i,1)[0];
  spinDigits(it);
  setTimeout(()=>showWinner(it,p),2000);
 }
}

function showWinner(it,p){
 winnerName.innerText=it.name;
 winnerCode.innerText="M√£ s·ªë: "+it.code;
 winnerBox.style.display="flex";
 setTimeout(()=>{
  winnerBox.style.display="none";
  results.push({prize:p,...it});
  localStorage.setItem("ITEMS",JSON.stringify(items));
  localStorage.setItem("RESULTS",JSON.stringify(results));
  renderTable();
 },3000);
}

function renderTable(){
 resultTable.innerHTML="";
 results.forEach(r=>{
  resultTable.innerHTML+=`<tr><td class="prize">${r.prize}</td><td class="code">${r.code}</td><td>${r.name}</td></tr>`;
 });
}

function exportCSV(){
 let csv="Prize,Code,Name\n";
 results.forEach(r=>csv+=`${r.prize},${r.code},${r.name}\n`);
 let a=document.createElement("a");
 a.href=URL.createObjectURL(new Blob([csv]));
 a.download="ketqua_quayso.csv";a.click();
}

function resetAll(){
 if(!confirm("RESET to√†n b·ªô d·ªØ li·ªáu?"))return;
 localStorage.clear();items=[...defaultItems];results=[];
 renderTable();document.querySelectorAll(".digit").forEach(d=>d.innerText="0");
}

/* IMPORT EXCEL */
function importExcel(e){
 const f=e.target.files[0];if(!f)return;
 const r=new FileReader();
 r.onload=x=>{
  const wb=XLSX.read(new Uint8Array(x.target.result),{type:"array"});
  const sh=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
  items=[];results=[];
  sh.forEach(row=>{
   if(row.code&&row.name)items.push({code:String(row.code),name:String(row.name)});
  });
  localStorage.setItem("ITEMS",JSON.stringify(items));
  localStorage.removeItem("RESULTS");
  renderTable();
  alert("‚úÖ Import Excel: "+items.length+" ng∆∞·ªùi");
 };
 r.readAsArrayBuffer(f);
}
</script>
</body>
</html>
