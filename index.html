<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Lucky Draw Pro</title>

<style>
body{
  background:url("nen.jpg") center/cover no-repeat fixed;
  font-family:'Segoe UI',Arial;
  color:#fff;
  text-align:center;
  margin:0;
  min-height:100vh;
}
.overlay{
  background:rgba(0,0,0,0.35);
  min-height:100vh;
  padding-top:50px;
}
h1{
  font-size:56px;
  margin-bottom:25px;
  letter-spacing:3px;
  text-shadow:0 4px 10px rgba(0,0,0,.6);
}
select{
  padding:12px 20px;
  font-size:20px;
  border-radius:12px;
  border:none;
  outline:none;
  margin-bottom:25px;
}
.slot{
  display:flex;
  justify-content:center;
  gap:14px;
  margin:30px 0;
}
.digit{
  width:80px;
  height:110px;
  background:#1b5e20;
  color:#fff;
  font-size:64px;
  font-weight:bold;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:
    inset 0 -8px 0 rgba(0,0,0,.35),
    0 10px 25px rgba(0,0,0,.5);
  transition:transform .12s;
}
#spinBtn{
  width:170px;
  height:170px;
  border-radius:50%;
  background:#2e7d32;
  color:#fff;
  font-size:32px;
  font-weight:bold;
  border:none;
  cursor:pointer;
  box-shadow:0 15px 35px rgba(0,0,0,.6);
}
#spinBtn:hover{
  background:#43a047;
  transform:scale(1.08);
}
#exportBtn{
  margin-top:30px;
  background:#e53935;
  color:#fff;
  padding:14px 40px;
  border-radius:40px;
  font-size:20px;
  border:none;
  cursor:pointer;
  box-shadow:0 10px 25px rgba(0,0,0,.5);
}
#log{
  margin:30px auto;
  max-width:600px;
  max-height:200px;
  overflow:auto;
  text-align:left;
  font-size:16px;
  text-shadow:0 2px 4px rgba(0,0,0,.6);
}
</style>
</head>

<body>
<div class="overlay">

  <h1>üéØ QUAY S·ªê MAY M·∫ÆN</h1>

  üéÅ <b>Ch·ªçn gi·∫£i:</b><br>
  <select id="prize">
    <option>Gi·∫£i Nh·∫•t</option>
    <option>Gi·∫£i Nh√¨</option>
    <option>Gi·∫£i Ba</option>
    <option>Khuy·∫øn Kh√≠ch</option>
  </select>

  <div class="slot">
    <div class="digit">0</div>
    <div class="digit">0</div>
    <div class="digit">0</div>
    <div class="digit">0</div>
    <div class="digit">0</div>
  </div>

  <button id="spinBtn" onclick="draw()">QUAY</button><br>
  <button id="exportBtn" onclick="exportCSV()">üì• Xu·∫•t k·∫øt qu·∫£</button>

  <div id="log"></div>
</div>

<script>
/* ====== STORAGE KEY ====== */
const KEY_ITEMS = "LUCKY_ITEMS";
const KEY_RESULTS = "LUCKY_RESULTS";

/* ====== DANH S√ÅCH G·ªêC ====== */
const defaultItems = [
 {code:"00001",name:"Nguy·ªÖn VƒÉn A"},
 {code:"00002",name:"Tr·∫ßn Th·ªã B"},
 {code:"00003",name:"L√™ VƒÉn C"},
 {code:"00004",name:"Ph·∫°m Th·ªã D"},
 {code:"00005",name:"Ho√†ng VƒÉn E"},
];

/* ====== LOAD TR·∫†NG TH√ÅI ====== */
let items = JSON.parse(localStorage.getItem(KEY_ITEMS)) || [...defaultItems];
let results = JSON.parse(localStorage.getItem(KEY_RESULTS)) || [];

/* ====== PH·ª§C H·ªíI LOG SAU RELOAD ====== */
window.onload = ()=>{
  results.forEach(r=>{
    document.getElementById("log").innerHTML +=
      "üèÜ <b>"+r.prize+"</b>: "+r.code+" - "+r.name+"<br>";
  });
};

/* ====== SLOT EFFECT ====== */
function spinDigits(target){
  let digits=document.querySelectorAll(".digit");
  let loop=0;
  let max=22;

  let interval=setInterval(()=>{
    digits.forEach(d=>{
      d.innerText=Math.floor(Math.random()*10);
      d.style.transform="scale(1.1)";
    });
    loop++;
    if(loop>max){
      clearInterval(interval);
      target.code.split("").forEach((n,i)=>{
        digits[i].innerText=n;
        digits[i].style.transform="scale(1)";
      });
    }
  },70);
}

/* ====== QUAY ====== */
function draw(){
  if(items.length===0){
    alert("H·∫æT DANH S√ÅCH");
    return;
  }

  let i=Math.floor(Math.random()*items.length);
  let item=items.splice(i,1)[0];
  spinDigits(item);

  let prize=document.getElementById("prize").value;
  results.push({prize,...item});

  /* L∆ØU TR·∫†NG TH√ÅI */
  localStorage.setItem(KEY_ITEMS,JSON.stringify(items));
  localStorage.setItem(KEY_RESULTS,JSON.stringify(results));

  setTimeout(()=>{
    document.getElementById("log").innerHTML+=
      "üèÜ <b>"+prize+"</b>: "+item.code+" - "+item.name+"<br>";
  },2000);
}

/* ====== EXPORT ====== */
function exportCSV(){
  let csv="Prize,Code,Name\n";
  results.forEach(r=>{
    csv+=`${r.prize},${r.code},${r.name}\n`;
  });
  let blob=new Blob([csv],{type:"text/csv"});
  let a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="ketqua_quayso.csv";
  a.click();
}

/* ====== RESET B√ç M·∫¨T ======
   Ctrl + Alt + R */
document.addEventListener("keydown",e=>{
  if(e.ctrlKey && e.altKey && e.key==="R"){
    if(confirm("RESET TO√ÄN B·ªò K·∫æT QU·∫¢?")){
      localStorage.removeItem(KEY_ITEMS);
      localStorage.removeItem(KEY_RESULTS);
      location.reload();
    }
  }
});
</script>
</body>
</html>
