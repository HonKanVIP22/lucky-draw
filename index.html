<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Lucky Draw Pro</title>

<style>
body{
  background:url("nen.jpg") center/cover no-repeat fixed;
  font-family:'Segoe UI',Arial;
  color:#fff;
  text-align:center;
  margin:0;
  min-height:100vh;
}
.overlay{
  background:rgba(0,0,0,0.35);
  min-height:100vh;
  padding-top:40px;
}

/* ===== TITLE ===== */
h1{
  font-size:64px;
  font-weight:900;
  letter-spacing:4px;
  margin-bottom:20px;
  background:linear-gradient(90deg,#fff176,#ffeb3b,#ffc107);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

/* ===== RIGHT PANEL ===== */
.right-panel{
  position:fixed;
  top:20px;
  right:20px;
  width:230px;
  background:rgba(0,0,0,.55);
  border-radius:20px;
  padding:16px;
  box-shadow:0 10px 35px rgba(0,0,0,.6);
}
.right-panel select,
.right-panel input,
.right-panel button{
  width:100%;
  margin-bottom:12px;
  padding:10px;
  border-radius:14px;
  border:none;
  font-size:14px;
  font-weight:700;
}
.right-panel button{cursor:pointer}
#exportBtn{background:#c62828;color:#fff}
#resetBtn{background:#1565c0;color:#fff}

/* ===== SLOT ===== */
.slot{
  display:flex;
  justify-content:center;
  gap:16px;
  margin:30px 0;
}
.digit{
  width:84px;
  height:118px;
  background:linear-gradient(180deg,#2e7d32,#1b5e20);
  font-size:66px;
  font-weight:900;
  border-radius:16px;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* ===== SPIN BUTTON ===== */
#spinBtn{
  width:190px;
  height:190px;
  border-radius:50%;
  background:radial-gradient(circle,#66bb6a,#1b5e20);
  font-size:34px;
  font-weight:900;
  border:none;
  cursor:pointer;
}

/* ===== WINNER DISPLAY ===== */
#winnerBox{
  display:none;
  margin:20px auto;
  padding:30px;
  width:80%;
  max-width:700px;
  background:rgba(0,0,0,.75);
  border-radius:26px;
  box-shadow:0 0 40px rgba(255,215,0,.9);
}
#winnerBox h2{
  font-size:36px;
  color:#ffeb3b;
  margin-bottom:12px;
}
#winnerName{
  font-size:46px;
  font-weight:900;
  letter-spacing:1px;
}
#winnerCode{
  margin-top:10px;
  font-size:22px;
  opacity:.9;
}

/* ===== RESULT ===== */
.result-box{
  margin:50px auto;
  width:88%;
  max-width:980px;
  background:rgba(0,0,0,.5);
  border-radius:24px;
  padding:24px;
}
table{width:100%;border-collapse:collapse}
th,td{padding:14px}
.prize{color:#ffd54f;font-weight:800}
.code{font-family:monospace;font-size:18px}
</style>
</head>

<body>
<div class="overlay">

<h1>QUAY S·ªê MAY M·∫ÆN</h1>

<div class="slot">
  <div class="digit">0</div>
  <div class="digit">0</div>
  <div class="digit">0</div>
  <div class="digit">0</div>
  <div class="digit">0</div>
</div>

<button id="spinBtn" onclick="draw()">QUAY</button>

<!-- HI·ªÇN TH·ªä NG∆Ø·ªúI TR√öNG -->
<div id="winnerBox">
  <h2>üéâ CH√öC M·ª™NG üéâ</h2>
  <div id="winnerName"></div>
  <div id="winnerCode"></div>
</div>

<div class="result-box">
  <h2>üèÜ DANH S√ÅCH TR√öNG TH∆Ø·ªûNG</h2>
  <table>
    <thead>
      <tr>
        <th>Gi·∫£i</th>
        <th>M√£ s·ªë</th>
        <th>H·ªç t√™n</th>
      </tr>
    </thead>
    <tbody id="resultTable"></tbody>
  </table>
</div>

</div>

<!-- PANEL PH·∫¢I -->
<div class="right-panel">
  <select id="prize">
    <option>Gi·∫£i Nh·∫•t</option>
    <option>Gi·∫£i Nh√¨</option>
    <option>Gi·∫£i Ba</option>
    <option>Khuy·∫øn Kh√≠ch</option>
  </select>

  <input id="drawCount" type="number" value="1" min="1">

  <button id="exportBtn" onclick="exportCSV()">üì• Xu·∫•t k·∫øt qu·∫£</button>
  <button id="resetBtn" onclick="resetAll()">üîÑ Reset</button>
</div>

<script>
const KEY_ITEMS="LUCKY_ITEMS";
const KEY_RESULTS="LUCKY_RESULTS";

const defaultItems=[
 {code:"00001",name:"Nguy·ªÖn VƒÉn A"},
 {code:"00002",name:"Tr·∫ßn Th·ªã B"},
 {code:"00003",name:"L√™ VƒÉn C"},
 {code:"00004",name:"Ph·∫°m Th·ªã D"},
 {code:"00005",name:"Ho√†ng VƒÉn E"},
];

let items=JSON.parse(localStorage.getItem(KEY_ITEMS))||[...defaultItems];
let results=JSON.parse(localStorage.getItem(KEY_RESULTS))||[];

window.onload=renderTable;

function spinDigits(target){
  let d=document.querySelectorAll(".digit");
  let i=0;
  let it=setInterval(()=>{
    d.forEach(x=>x.innerText=Math.floor(Math.random()*10));
    if(++i>20){
      clearInterval(it);
      target.code.split("").forEach((n,j)=>d[j].innerText=n);
    }
  },70);
}

function draw(){
  let count=parseInt(drawCount.value)||1;
  if(count>items.length){alert("Kh√¥ng ƒë·ªß ng∆∞·ªùi");return;}

  let prize=prizeSelect=prize.value;
  let delay=0;

  for(let k=0;k<count;k++){
    setTimeout(()=>{
      let i=Math.floor(Math.random()*items.length);
      let item=items.splice(i,1)[0];
      spinDigits(item);

      setTimeout(()=>{
        showWinner(item,prize);
      },1200);

    },delay);
    delay+=4000;
  }
}

function showWinner(item,prize){
  winnerName.innerText=item.name;
  winnerCode.innerText="M√£ s·ªë: "+item.code;
  winnerBox.style.display="block";

  setTimeout(()=>{
    winnerBox.style.display="none";
    results.push({prize,...item});
    localStorage.setItem(KEY_ITEMS,JSON.stringify(items));
    localStorage.setItem(KEY_RESULTS,JSON.stringify(results));
    renderTable();
  },3000);
}

function renderTable(){
  resultTable.innerHTML="";
  results.forEach(r=>{
    resultTable.innerHTML+=`
      <tr>
        <td class="prize">${r.prize}</td>
        <td class="code">${r.code}</td>
        <td>${r.name}</td>
      </tr>`;
  });
}

function exportCSV(){
  let csv="Prize,Code,Name\n";
  results.forEach(r=>csv+=`${r.prize},${r.code},${r.name}\n`);
  let a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv]));
  a.download="ketqua_quayso.csv";
  a.click();
}

function resetAll(){
  if(!confirm("RESET to√†n b·ªô d·ªØ li·ªáu?"))return;
  localStorage.clear();
  items=[...defaultItems];
  results=[];
  renderTable();
}
</script>
</body>
</html>
